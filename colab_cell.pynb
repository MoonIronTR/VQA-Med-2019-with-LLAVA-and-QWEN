# 1. Drive BaÄŸla
from google.colab import drive
drive.mount('/content/drive')

# 2. Kurulumlar (Qwen gereksinimleri Ã§Ä±karÄ±ldÄ±, hÄ±zlÄ± kurulum)
print("ðŸ“¦ KÃ¼tÃ¼phaneler kuruluyor...")
!pip install -q streamlit pyngrok
!pip install -q transformers peft bitsandbytes accelerate safetensors
!pip install -q nltk sentence-transformers huggingface_hub

# 3. Token ve GiriÅŸ Ä°ÅŸlemleri
from google.colab import userdata
from huggingface_hub import login
from pyngrok import ngrok
import os
import time

try:
    ngrok_key = userdata.get('NGROK_TOKEN')
    hf_key = userdata.get('HF_TOKEN')

    ngrok.kill() # Eski tÃ¼neli kapat
    !ngrok config add-authtoken $ngrok_key
    login(token=hf_key)
    print("âœ… GiriÅŸ baÅŸarÄ±lÄ±!")
except Exception as e:
    print(f"âŒ Token hatasÄ±: {e}")

# 4. UygulamayÄ± BaÅŸlat
script_path = "/content/drive/MyDrive/VQA_Multi/app_multi_colab.py"

if not os.path.exists(script_path):
    print(f"âŒ HATA: Dosya bulunamadÄ± -> {script_path}")
else:
    print(f"ðŸš€ Uygulama baÅŸlatÄ±lÄ±yor...")
    get_ipython().system_raw(f'streamlit run "{script_path}" --server.port 8501 &')
    time.sleep(4)
    try:
        public_url = ngrok.connect(8501).public_url
        print("\n" + "="*50)
        print(f"ðŸŽ‰ TIKLA VE GÄ°T -> {public_url}")
        print("="*50 + "\n")
    except Exception as e:
        print(f"TÃ¼nel hatasÄ±: {e}")

    while True: time.sleep(100)